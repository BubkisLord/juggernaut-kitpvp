execute if score #game_state var matches 11 as @a at @s run title @s actionbar [{"text":"Total Replenishment: ","color": "dark_aqua","bold": true},{"score":{"name":"#juggernaut_manager","objective":"replenish_decimal"},"bold": true,"color": "dark_aqua"},{"text": "%"},{"text": " [","color": "dark_aqua","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "dark_aqua","bold":true},{"text": "/","color": "dark_aqua","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "dark_aqua","bold":true},{"text": "]","color": "dark_aqua","bold":true}]

execute if score #game_state var matches 11 as @a[tag=runner] at @s run scoreboard players operation @s replenish_modifier = @s replenish_buff
execute if score #game_state var matches 11 as @a[tag=runner] at @s run scoreboard players operation @s replenish_modifier -= @s replenish_debuff

# Display actionbar for the closest station to a runner when not in chase
# When debuffed
execute if score #game_state var matches 11 as @a[tag=runner,tag=!in_chase] at @s if score @s replenish_debuff > @s replenish_buff run title @s actionbar [{"text":"Station Percentage: ","color": "red","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,distance=..6]","objective":"replenish_decimal"},"bold": true,"color": "red"},{"text": "%"},{"text": " [","color": "red","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "red","bold":true},{"text": "/","color": "red","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "red","bold":true},{"text": "]","color": "red","bold":true},{"text": " (","color": "red","bold": true},{"score": {"name": "@s","objective": "replenish_modifier"},"color": "red","bold": true},{"text": "% Speed)","color": "red","bold": true}]
# When normal speed
execute if score #game_state var matches 11 as @a[tag=runner,tag=!in_chase] at @s if score @s replenish_modifier = #0 var run title @s actionbar [{"text":"Station Percentage: ","color": "gold","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,distance=..6]","objective":"replenish_decimal"},"bold": true,"color": "gold"},{"text": "%"},{"text": " [","color": "gold","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "gold","bold":true},{"text": "/","color": "gold","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "gold","bold":true},{"text": "]","color": "gold","bold":true}]
# When buffed
execute if score #game_state var matches 11 as @a[tag=runner,tag=!in_chase] at @s if score @s replenish_debuff < @s replenish_buff run title @s actionbar [{"text":"Station Percentage: ","color": "green","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,distance=..6]","objective":"replenish_decimal"},"bold": true,"color": "green"},{"text": "%"},{"text": " [","color": "green","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "green","bold":true},{"text": "/","color": "green","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "green","bold":true},{"text": "]","color": "green","bold":true},{"text": " (+","color": "green","bold": true},{"score": {"name": "@s","objective": "replenish_modifier"},"color": "green","bold": true},{"text": "% Speed)","color": "green","bold": true}]

# Display the most progressed station to a runner when in chase (as that is what they are progressing)
# When debuffed
execute if score #game_state var matches 11 as @a[tag=runner,tag=in_chase] at @s if score @s replenish_debuff > @s replenish_buff run title @s actionbar [{"text":"Replenishment Percentage: ","color": "red","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,tag=highest_station]","objective":"replenish_decimal"},"bold": true,"color": "red"},{"text": "%"},{"text": " [","color": "red","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "red","bold":true},{"text": "/","color": "red","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "red","bold":true},{"text": "]","color": "red","bold":true},{"text": " (","color": "red","bold": true},{"score": {"name": "@s","objective": "replenish_modifier"},"color": "red","bold": true},{"text": "% Speed)","color": "red","bold": true}]
# When normal speed
execute if score #game_state var matches 11 as @a[tag=runner,tag=in_chase] at @s if score @s replenish_modifier = #0 var run title @s actionbar [{"text":"Replenishment Percentage: ","color": "gold","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,tag=highest_station]","objective":"replenish_decimal"},"bold": true,"color": "gold"},{"text": "%"},{"text": " [","color": "gold","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "gold","bold":true},{"text": "/","color": "gold","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "gold","bold":true},{"text": "]","color": "gold","bold":true}]
# When buffed
execute if score #game_state var matches 11 as @a[tag=runner,tag=in_chase] at @s if score @s replenish_debuff < @s replenish_buff run title @s actionbar [{"text":"Replenishment Percentage: ","color": "green","bold": true},{"score":{"name":"@n[type=armor_stand,tag=replenishment.station,tag=highest_station]","objective":"replenish_decimal"},"bold": true,"color": "green"},{"text": "%"},{"text": " [","color": "green","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "green","bold":true},{"text": "/","color": "green","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "green","bold":true},{"text": "]","color": "green","bold":true},{"text": " (+","color": "green","bold": true},{"score": {"name": "@s","objective": "replenish_modifier"},"color": "green","bold": true},{"text": "% Speed)","color": "green","bold": true}]

# Replenishment Tower
execute if score #game_state var matches 11 as @a[tag=engineer] at @s if entity @e[type=armor_stand,tag=replenishment_tower,distance=..3] run title @s actionbar [{"text":"Station Percentage: ","color": "gold","bold": true},{"score":{"name":"@n[type=armor_stand,tag=highest_station]","objective":"replenish_decimal"},"bold": true,"color": "gold"},{"text": "%"},{"text": " [","color": "gold","bold":true},{"score":{"name":"#stations_completed","objective":"var"},"color": "gold","bold":true},{"text": "/","color": "gold","bold":true},{"score":{"name":"#stations_needed","objective":"var"},"color": "gold","bold":true},{"text": "]","color": "gold","bold":true}]
execute if score #game_state var matches 11 as @a[tag=engineer] at @s if entity @e[type=armor_stand,tag=replenishment_tower,distance=..3] run particle end_rod ~ ~ ~ 0.5 1 0.5 0.00001 2 force